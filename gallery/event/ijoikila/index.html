<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FyLinx Gallery</title>

<style>
body{
  margin:0;
  font-family:system-ui,sans-serif;
  background:#fff;
  color:#111;
}

/* ===== HEADER ===== */
header{
  position:sticky;
  top:0;
  z-index:5;
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:14px 16px;
  border-bottom:1px solid #eee;
  background:#fff;
}
header h1{font-size:14px;margin:0}
header span{font-size:12px;color:#777}

/* ===== GALLERY ===== */
.gallery{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:4px;
  padding:6px;
}
@media(min-width:600px){.gallery{grid-template-columns:repeat(4,1fr)}}
@media(min-width:1024px){.gallery{grid-template-columns:repeat(6,1fr)}}

.gallery img{
  width:100%;
  aspect-ratio:1/1;
  object-fit:cover;
  border-radius:4px;
  cursor:pointer;
}

/* sentinel */
#sentinel{
  grid-column:1/-1;
  height:1px;
}

/* ===== MODAL ===== */
.modal{
  position:fixed;
  inset:0;
  display:none;
  z-index:20;
}

/* click-to-close layer */
.backdrop{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.92);
}

/* ===== SLIDER ===== */
.slider{
  position:relative;
  display:flex;
  width:300vw;
  height:100%;
  transform:translateX(-100vw);
  transition:transform .35s cubic-bezier(.22,.61,.36,1);
  pointer-events:auto;
}

.slide{
  width:100vw;
  display:flex;
  align-items:center;
  justify-content:center;
}

.slide img{
  max-width:96vw;
  max-height:90vh;
  object-fit:contain;
}

body.modal-open{
  overflow:hidden;
}
</style>
</head>

<body>

<header>
  <h1>FyLinx</h1>
  <span>Ijoy & Kila</span>
</header>

<div class="gallery" id="gallery">
  <div id="sentinel"></div>
</div>

<div class="modal" id="modal">
  <div class="backdrop" id="backdrop"></div>
  <div class="slider" id="slider">
    <div class="slide"><img id="prevImg"></div>
    <div class="slide"><img id="currentImg"></div>
    <div class="slide"><img id="nextImg"></div>
  </div>
</div>

<script>
const API_KEY="AIzaSyCyL4jxLN9w87WG20GqeEIAaUCupjKmn8U";
const FOLDER_ID="1qEfxwXgPcvEPRlBKNNecsHaqFSRrAjTE";
const PAGE_SIZE=24;

const gallery=document.getElementById("gallery");
const sentinel=document.getElementById("sentinel");

const modal=document.getElementById("modal");
const backdrop=document.getElementById("backdrop");
const slider=document.getElementById("slider");
const prevImg=document.getElementById("prevImg");
const currentImg=document.getElementById("currentImg");
const nextImg=document.getElementById("nextImg");

let modalImageIds=[];
let currentIndex=0;
let nextPageToken=null;
let loading=false;

/* ===== LOAD IMAGES ===== */
async function loadNextImages(){
  if(loading) return;
  loading=true;

  const q=encodeURIComponent(`'${FOLDER_ID}' in parents and mimeType contains 'image/'`);
  let url=`https://www.googleapis.com/drive/v3/files?q=${q}&orderBy=name desc&pageSize=${PAGE_SIZE}&fields=nextPageToken,files(id)&key=${API_KEY}`;
  if(nextPageToken) url+=`&pageToken=${nextPageToken}`;

  const res=await fetch(url);
  const data=await res.json();
  nextPageToken=data.nextPageToken||null;

  data.files.forEach(file=>{
    modalImageIds.push(file.id);
    const i=modalImageIds.length-1;
    const img=document.createElement("img");
    img.src=`https://drive.google.com/thumbnail?id=${file.id}&sz=w500`;
    img.onclick=()=>openModal(i);
    gallery.insertBefore(img,sentinel);
  });

  loading=false;
}

/* ===== MODAL ===== */
function openModal(i){
  currentIndex=i;
  updateSlider();
  modal.style.display="block";
  document.body.classList.add("modal-open");
}

function closeModal(){
  modal.style.display="none";
  document.body.classList.remove("modal-open");
}

backdrop.onclick=closeModal;

function updateSlider(){
  const l=modalImageIds.length;
  prevImg.src = currentIndex>0 ? `https://lh3.googleusercontent.com/d/${modalImageIds[currentIndex-1]}` : "";
  currentImg.src = `https://lh3.googleusercontent.com/d/${modalImageIds[currentIndex]}`;
  nextImg.src = currentIndex<l-1 ? `https://lh3.googleusercontent.com/d/${modalImageIds[currentIndex+1]}` : "";

  slider.style.transition="none";
  slider.style.transform="translateX(-100vw)";
  requestAnimationFrame(()=>{
    slider.style.transition="transform .35s cubic-bezier(.22,.61,.36,1)";
  });
}

/* ===== SWIPE ===== */
let startX=0,dx=0,swipe=false;
const TH=70;

modal.addEventListener("touchstart",e=>{
  startX=e.touches[0].clientX;
  swipe=true;
},{passive:true});

modal.addEventListener("touchmove",e=>{
  if(!swipe) return;
  dx=e.touches[0].clientX-startX;
  slider.style.transform=`translateX(calc(-100vw + ${dx}px))`;
},{passive:true});

modal.addEventListener("touchend",()=>{
  if(!swipe) return;
  swipe=false;

  if(Math.abs(dx)<TH){
    slider.style.transform="translateX(-100vw)";
    return;
  }
  if(dx<0 && currentIndex<modalImageIds.length-1) currentIndex++;
  if(dx>0 && currentIndex>0) currentIndex--;
  updateSlider();
});

/* ===== KEYBOARD ===== */
window.addEventListener("keydown",e=>{
  if(modal.style.display!=="block") return;
  if(e.key==="Escape") closeModal();
  if(e.key==="ArrowRight" && currentIndex<modalImageIds.length-1){currentIndex++;updateSlider();}
  if(e.key==="ArrowLeft" && currentIndex>0){currentIndex--;updateSlider();}
});

/* ===== INFINITE SCROLL ===== */
new IntersectionObserver(e=>{
  if(e[0].isIntersecting && nextPageToken) loadNextImages();
},{rootMargin:"400px"}).observe(sentinel);

loadNextImages();
</script>

</body>
</html>
